{% extends 'index.html' %}
{% block content %}
{% with messages = get_flashed_messages() %}
{% for message in messages %}
<div class="alert alert-warning alert-dismissible fade show flash-messages" role="alert">
  <div class="d-flex align-items-center"> <!-- Make the icon and text flex items -->
      <div>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">
          <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
        </svg>
      </div>
      <div class="ms-2"> <!-- Add margin to separate the icon from the text -->
          {{ message }}
      </div>
  </div>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endfor %}
{% endwith %}
<div class="form-centered p-3 shadow">
  <form role="search" method="post" action="{{ url_for('restock') }}" autocomplete="off">
    <div class="mb-3">
      <label for="stockName" class="form-label">Item Restocked</label>
      <div class="input-group">
        <input type="text" class="form-control" id="stockName" name="stockName" oninput="showStockOptions(this.value)" autocomplete="off">
      </div>
      <ul id="stockOptions" class="list-group mt-2" style="display: none;">
        {% for stock in stocks %}
          <li class="list-group-item" onclick="selectStock('{{ stock.item_name }}')">{{ stock.item_name|title }}</li>
        {% endfor %}
      </ul>
    </div>
    <div class="mb-3">
      <label for="restockQuantity" class="form-label">Restocked Quantity</label>
      <input type="number" class="form-control" id="restockQuantity" name="restockQuantity" autocomplete="off">
    </div>
    <button type="submit" class="btn btn-primary">Restock Item</button>
  </form>
</div>
  
  <script>
    function showStockOptions(searchTerm) {
      var stockOptions = document.getElementById("stockOptions");
  
      // Filter stocks based on the search term
      var allStocks = Array.from(stockOptions.children);
      var filteredStocks = allStocks.filter(function(li) {
        return li.textContent.toLowerCase().includes(searchTerm.toLowerCase());
      });
  
      // Display the stock options dropdown if there are matches
      stockOptions.style.display = filteredStocks.length > 0 ? "block" : "none";
  
      // Toggle the display property for each stock option based on the search term
      allStocks.forEach(function(li) {
        var displayStyle = filteredStocks.includes(li) ? "block" : "none";
        li.style.display = displayStyle;
      });
    }
  
    function selectStock(stock) {
      document.getElementById("stockName").value = stock;
      document.getElementById("stockOptions").style.display = "none";
    }
  
    // Close the stock options dropdown when clicking outside
    document.addEventListener("click", function(event) {
      var stockOptions = document.getElementById("stockOptions");
      if (event.target.id !== "stockName" && !stockOptions.contains(event.target)) {
        stockOptions.style.display = "none";
      }
    });
  </script>
{% endblock %}